# --- SERVER ---
spring.application.name=BE
server.port=${SERVER_PORT:9999}
spring.banner.location=banner/banner.txt
server.version=${SERVER_VERSION:1.0.0}
allowed.origin=${ALLOWED_ORIGIN:http://localhost:6789}
frontend.url=${FRONTEND_URL:http://localhost:6789}
backend.url=${BACKEND_URL:http://localhost:9999}
server.forward-headers-strategy=framework
server.tomcat.remoteip.remote-ip-header=x-forwarded-for
server.tomcat.remoteip.protocol-header=x-forwarded-proto
server.tomcat.internal-proxies=.*
server.tomcat.use-relative-redirects=true


# --- WEBSOCKET ---
ws.applicationPrefix=/app
ws.topicPrefix=/topic
ws.registerEndpoint=/ws/registry


# --- DATABASE ---
# Database Configuration
# Database Generator Configuration
db.generator.is-generated=false
db.generator.user-email=nickhunter3009@gmail.com
db.generator.user-code=ADMIN
db.generator.user-name=Admin User

# Customer Generator Configuration
db.generator.customer.is-generated=false
db.generator.customer.email=nickhunter3009@gmail.com
db.generator.customer.code=CUSTOMER
db.generator.customer.name=Default Customer


spring.datasource.username=${SPRING_DATASOURCE_USERNAME:root}
spring.datasource.password=${SPRING_DATASOURCE_PASSWORD:123456}
spring.datasource.driver-class-name=${SPRING_DATASOURCE_DRIVER_CLASS_NAME:com.mysql.cj.jdbc.Driver}
spring.datasource.url=${SPRING_DATASOURCE_URL:jdbc:mysql://localhost:3306/catalog_web?createDatabaseIfNotExist=true&useSSL=false&serverTimezone=UTC&allowPublicKeyRetrieval=true}

# JPA/Hibernate
spring.jpa.hibernate.ddl-auto=update
spring.jpa.show-sql=true
spring.jpa.properties.hibernate.format_sql=true
spring.jpa.properties.hibernate.globally_quoted_identifiers=false
spring.jpa.properties.hibernate.jdbc.batch_size=100
spring.jpa.properties.hibernate.order_inserts=true
spring.jpa.properties.hibernate.order_updates=true
spring.jpa.properties.hibernate.jdbc.batch_versioned_data=true

# --- MEILISEARCH (Open-source Search Engine) ---
meilisearch.host=${MEILI_HOST:http://localhost:7700}
meilisearch.apiKey=${MEILI_MASTER_KEY:}

# --- HUGGING FACE (AI Content Generation) ---
# FREE Tier: 30,000 characters/month
# Optional: Leave empty to use FREE public API (rate-limited)
huggingface.api.key=${HUGGINGFACE_API_KEY:}
huggingface.api.url=https://api-inference.huggingface.co/models
spring.jpa.properties.hibernate.generate_statistics=false
spring.jpa.properties.hibernate.jdbc.fetch_size=100
spring.jpa.properties.hibernate.connection.provider_disables_autocommit=true
spring.jpa.properties.hibernate.query.fail_on_pagination_over_collection_fetch=true
spring.jpa.open-in-view=false

# Explicit Dialect to avoid startup check failure
spring.jpa.properties.hibernate.dialect=org.hibernate.dialect.MySQLDialect

# Data Initialization
# Note: The following are disabled because they conflict with Flyway migrations
# Flyway handles all database schema and data initialization
# spring.jpa.defer-datasource-initialization=true
# spring.sql.init.mode=always

# Flyway Configuration
spring.flyway.enabled=true
spring.flyway.baseline-on-migrate=true
spring.flyway.locations=classpath:db/migration
spring.flyway.baseline-version=1
spring.flyway.out-of-order=false
spring.flyway.validate-on-migrate=true

# HikariCP Connection Pool Configuration
spring.datasource.hikari.maximum-pool-size=20
spring.datasource.hikari.minimum-idle=5
spring.datasource.hikari.connection-timeout=30000
spring.datasource.hikari.idle-timeout=600000
spring.datasource.hikari.max-lifetime=1800000
spring.datasource.hikari.pool-name=CatalogWebHikariPool

# Actuator - Monitoring Endpoints
management.endpoints.web.exposure.include=health,metrics,prometheus,hikaricp
management.endpoint.health.show-details=when-authorized
management.metrics.enable.hikari=true
management.metrics.enable.jvm=true
management.metrics.enable.cache=true

# Health Check Configuration - Disable checks for services not running in dev
management.health.redis.enabled=false
management.health.rabbit.enabled=false
management.health.elasticsearch.enabled=false
management.health.db.enabled=true

# Show SQL for batch tables
logging.level.org.springframework.jdbc.core.JdbcTemplate=DEBUG
logging.level.org.springframework.batch.core.repository=DEBUG

# Email Configuration (Mocked in non-production)
spring.mail.host=localhost
spring.mail.port=25
spring.mail.username=Tongankhang0407@gmail.com
spring.mail.password=
spring.mail.properties.mail.smtp.auth=false
spring.mail.properties.mail.smtp.starttls.enable=false
spring.mail.properties.mail.debug=true
spring.mail.properties.mail.smtp.ssl.trust=${MAIL_HOST:smtp.gmail.com}
spring.mail.properties.mail.smtp.starttls.required=true
spring.mail.properties.mail.smtp.ssl.protocols=TLSv1.2
spring.datasource.hikari.auto-commit=false
spring.main.allow-bean-definition-overriding=true

# --- SECURITY / JWT / OAUTH2 ---
# JWT Configuration
# The secret key must be base64-encoded and at least 256 bits (32 bytes) long
jwt.secret=${JWT_SECRET:}
jwt.expiration=86400000
jwt.refresh-token.expiration-time=604800000

# Enable debug logging for JWT and security
logging.level.udpm.hn.server.infrastructure.security=DEBUG

spring.security.oauth2.client.registration.google.client-id=${GOOGLE_CLIENT_ID:}
spring.security.oauth2.client.registration.google.client-secret=${GOOGLE_CLIENT_SECRET:}
spring.security.oauth2.client.registration.google.scope=profile,email
spring.security.oauth2.client.registration.google.redirect-uri=${BACKEND_URL:http://localhost:9999}/login/oauth2/code/google
spring.security.oauth2.client.registration.google.authorization-grant-type=authorization_code
spring.security.oauth2.client.provider.google.authorization-uri=https://accounts.google.com/o/oauth2/v2/auth
spring.security.oauth2.client.provider.google.token-uri=https://www.googleapis.com/oauth2/v4/token
spring.security.oauth2.client.provider.google.user-info-uri=https://www.googleapis.com/oauth2/v3/userinfo
spring.security.oauth2.client.provider.google.user-name-attribute=name

# --- CORS ---
cors.allowed-origins=${ALLOWED_ORIGIN:http://localhost:6789},${CORS_ALLOWED_ORIGINS:http://localhost:3000}
cors.allowed-methods=${CORS_ALLOWED_METHODS:GET,POST,PUT,DELETE,OPTIONS}
cors.allowed-headers=*
cors.allow-credentials=true


logging.level.org.springframework.security.oauth2=DEBUG
# --- LOGGING ---
logging.level.org.springframework.security=${LOG_SECURITY:INFO}
logging.level.org.springframework.web.client.RestTemplate=${LOG_REST:DEBUG}
logging.level.org.springframework.data=${LOG_DATA:ERROR}



# --- REDIS LOCAL CONFIG ---
spring.data.redis.host=localhost
spring.data.redis.port=6379

# --- VAPID KEYS ---
vapid.public.key=BD4tPWb8iOR7FMzf-ZNYruXoUjkJn8T7950kjLtoWln3hj-7tPI4Kc0mGVL4MaELGClQ0KFpf78vCGjSLo4S5d4
vapid.private.key=kp5BQ7LdQO1JzkPAvSX5crRzibBFnzveEeO1MP0ZWbg

# --- ADMIN ALERTS ---
admin-alerts.email.enabled=${ADMIN_ALERTS_EMAIL_ENABLED:true}
admin-alerts.email.recipients=${ADMIN_ALERTS_EMAIL_RECIPIENTS:admin@example.com}
admin-alerts.slack.enabled=${ADMIN_ALERTS_SLACK_ENABLED:false}
admin-alerts.slack.webhook-url=${ADMIN_ALERTS_SLACK_WEBHOOK:}
admin-alerts.batch-cron=${ADMIN_ALERTS_BATCH_CRON:0 0 * * * ?}
spring.application.base-url=${FRONTEND_URL:http://localhost:6789}

# --- MEDIA VALIDATION ---
media.validation.max-image-size-mb=${MAX_IMAGE_SIZE_MB:10}
media.validation.max-video-size-mb=${MAX_VIDEO_SIZE_MB:100}
media.validation.allowed-image-types=${ALLOWED_IMAGE_TYPES:jpg,jpeg,png,gif,webp}
media.validation.allowed-video-types=${ALLOWED_VIDEO_TYPES:mp4,webm,avi,mov}
media.validation.virus-scan-enabled=${VIRUS_SCAN_ENABLED:false}
media.validation.virus-scan-api=${VIRUS_SCAN_API:}

# --- MEDIA WATERMARK ---
media.watermark.enabled=${WATERMARK_ENABLED:false}
media.watermark.text=${WATERMARK_TEXT:FPL UDPM Catalog}
media.watermark.opacity=${WATERMARK_OPACITY:0.3}
media.watermark.position=${WATERMARK_POSITION:bottom-right}

# --- DATABASE BACKUP ---
backup.schedule=${BACKUP_SCHEDULE:0 0 2 * * ?}
backup.s3-bucket=${BACKUP_S3_BUCKET:fpl-catalog-backups}
backup.retention-days=${BACKUP_RETENTION_DAYS:30}



github.api.token=${GITHUB_API_TOKEN:}
